

<!DOCTYPE html>
<html>
<head>
    <!-- metadata -->
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="shortcut icon" href="/images/lgDomain/favicon.ico" />
<title>LG U+ CDN Management Portal</title>

<!-- jquery -->
<script src="/js/jquery-3.1.1.min.js"></script>

<!-- moment -->
<script src="/js/plugins/moment/moment.min.js" type="text/javascript"></script>

<!-- validation -->
<script src="https://ajax.aspnetcdn.com/ajax/jquery.validate/1.11.1/jquery.validate.min.js"></script>


<!-- Serialize object or json -->
<script src="/js/jquery.serializeObject.min.js" type="text/javascript"></script>

<!-- custom util scripts -->
<script src="/js/ajax.js"></script>
<script>
	function getCsrf() {
		return "06e29f2d-8db8-4c4e-b0b7-05d6ba6647ca";
	}
</script>

    <link href="/css/plugins/toastr/toastr.min.css" rel="stylesheet">
    <link href="/css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="/css/plugins/dataTables/datatables.min.css" rel="stylesheet">

    <!-- select only one -->
    <link href="/css/plugins/chosen/bootstrap-chosen.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">

    <!-- country falg -->
    <link href="/css/plugins/addons/flag.min.css" rel="stylesheet">

    <!-- common css -->
    <link href="/css/bootstrap.min.css" rel="stylesheet">
<link href="/font-awesome/css/font-awesome.css" rel="stylesheet">

<link href="/css/animate.css" rel="stylesheet">
<link href="/css/style.css" rel="stylesheet">

    <!-- custom style -->
    <style>
        #btnDropDown {
            cursor:pointer;
            /*color: #b4193d;*/
        }
        .icon-btn {
            cursor:pointer;
            color: #b4193d;
        }
        .icon-gray {
            color: #5a6268;
        }
    </style>
</head>

<body class="">
<div id="wrapper">

    <!-- left menu -->
    





<!-- side-menu //-->



<style>
	.logo-element span {
		background-image:url("/images/lgDomain/header-logo.png");
	}
	body.mini-navbar .logo-element span {
		background-image:url("/images/lgDomain/header-logo-mini.png");
	}
</style>

<nav class="navbar-default navbar-static-side" role="navigation" style="z-index: 2052";>
	<div class="sidebar-collapse">
		<ul class="nav metismenu" id="side-menu">
			<li class="nav-header">
				<div class="logo-element"><span>CDN Management Portal</span></div>
			</li>
			
				<li class="">
					<a href="/dashboard"><i class="fa fa-th-large"></i> <span class="nav-label">대시보드 </span></a>
				</li>
			

			
				<li class="">
					<a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">통계 </span><span class="fa arrow"></span></a>
					<ul class="nav nav-second-level collapse">
						
							<li class="">
								<a href="/statistics/traffic">트래픽</a>
							</li>
						
						
							<li class="">
								<a href="/statistics/transfer">전송량</a>
							</li>
						
						
							<li class="">
								<a href="/statistics/contents/contents">컨텐츠 정보</a>
							</li>
						
						
							<li class="">
								<a href="/statistics/access/request">접속 정보</a>
							</li>
						
						
							<li class="">
								<a href="/statistics/storage_stat">스토리지 사용량</a>
							</li>
						
					</ul>
				</li>
			

			
				<li class="">
					<a href="#"><i class="fa fa-bar-chart-o"></i> <span class="nav-label">오리진 통계 </span><span class="fa arrow"></span></a>
					<ul class="nav nav-second-level collapse">
						
							<li class="">
								<a href="/origin-statistics/traffic">트래픽</a>
							</li>
						
						
							<li class="">
								<a href="/origin-statistics/transfer">전송량</a>
							</li>
						
						
							<li class="">
								<a href="/origin-statistics/access/request">접속 정보</a>
							</li>
						
					</ul>
				</li>
			

			
				<li class="active">
					<a href="#"><i class="fa fa-desktop"></i> <span class="nav-label">관리 </span><span class="fa arrow"></span></a>
					<ul class="nav nav-second-level collapse">
						
							<li class="">
								<a href="/management/purge">퍼지</a>
							</li>
						
						
							<li class="">
								<a href="/management/preload">프리로드</a>
							</li>
						
						
							<li class="">
								<a href="/management/domain/list">도메인 관리</a>
							</li>
						
						
							<li class="">
								<a href="/management/domain-detail-info">도메인 세부 정보</a>
							</li>
						
						
							<li class="">
								<a href="/management/account/list">서브 계정 관리</a>
							</li>
						
						
							<li class="">
								<a href="/management/report/list">리포트 설정</a>
							</li>
						
						
							<li class="active">
								<a href="/management/acl/list">ACL 관리</a>
							</li>
						
					</ul>
				</li>
			

			

			

			
				<li>
					<a href="http://210.178.1.76:8880" target="_blank"><i class="fa fa-external-link"></i> <span class="nav-label">사용자 가이드 바로가기 </span></a>
				</li>
			

		</ul>
	</div>
</nav>
<!--// side-menu -->

    <!-- page-wrapper //-->
    <div id="page-wrapper" class="gray-bg">

        <!-- header -->
        







<script>

	function getCookie(cName){
		cName = cName + '=';
		var cookieData = document.cookie;
		var start = cookieData.indexOf(cName);
		var cValue = '';
		if(start != -1){
			start += cName.length;
			var end = cookieData.indexOf(';', start);
			if(end == -1)end = cookieData.length;
			cValue = cookieData.substring(start, end);
		}
		return unescape(cValue);
	}

	$(document).ready(function(){
		var $noticeModal;

		var notice_hide_cookie = getCookie("notice_hide");
		/*if((notice_hide_cookie === undefined || notice_hide_cookie === "") && ""!=="true"){*/
		if((notice_hide_cookie === undefined || notice_hide_cookie === "")){

			if("true"==="false"){
				callPortal('/api/notice/get', null, getCsrf(), function(data) {
					var notice = data.notice;
					if(notice != null && notice !== ""){
						$("#noticeModal").append(data.notice);
						$noticeModal = $("#noticeModal");
						$noticeModal.modal("show");
					}
				});
			}
		}

		$(document).on("click", "#noticeCheck", function () {
			var checked = this.checked;
			if(checked){
				var today = new Date();
				today.setHours( today.getHours() + 23-today.getHours() );
				today.setMinutes(today.getMinutes() + 60-today.getMinutes());
				document.cookie = 'notice_hide' + '=' + checked + ';expires=' + today.toUTCString() + ';path=/';
				$noticeModal.modal("hide");
			}
		});
	});
</script>
<style>
	
	.error {
		color: red;
	}
</style>

<!--notice modal-->
<div id="noticeModal" class="modal inmodal fade" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
</div>

<!-- border-bottom //-->
<div class="row border-bottom">
	<nav class="navbar navbar-static-top" role="navigation" style="margin-bottom:0">
		<div class="navbar-header"><a class="navbar-minimalize minimalize-styl-2 btn btn-primary" href="#"><i class="fa fa-bars"></i></a></div>
		<ul class="nav navbar-top-links navbar-right">
			<div class="row" style="width:330px">
				<li class="dropdown col-sm-7">
					<a class="dropdown-toggle count-info" data-toggle="dropdown" href="#"><i class="fa fa-user"></i> admin</a>
					<form role="form" id="formLogout" method="POST">
						<ul class="dropdown-menu dropdown-alerts">
							<li><a href="/account/detail" class="dropdown-item"><div><i class="fa fa-address-book fa-fw"></i> 계정정보</div></a></li>
							<li class="dropdown-divider"></li>
							<li id="logout"><a href="#" class="dropdown-item"><div><i class="fa fa-power-off fa-fw"></i> 로그아웃</div></a></li>
						</ul>
						<input type="hidden" name="_csrf" value="06e29f2d-8db8-4c4e-b0b7-05d6ba6647ca"/>
					</form>
				</li>
				<form class="col-sm-5" id="formLangSelect" method="GET" style="margin: auto;">
					<select class="form-control" id="lang-select" name="lang">
					</select>
				</form>
			</div>
		</ul>
	</nav>
</div>
<!--// border-bottom -->
<script>
	// Spring Message Init
	var msgSelectAll='전체';
	var msgPlaceHolder='검색어를 입력하세요';
	var msgNonSelected='선택';
	var msgNSelected='개 선택됨';
	var msgAllSelected='전체 선택됨';

	var msgEmptyTable='데이터가 존재하지 않습니다.';
	var msgInfo='_START_ ~ _END_ / 총 _TOTAL_ 개';
	var msgLengthMenu='보기 설정 _MENU_ 개';
	var msgSearch='검색';
	var msgZeroRecords='검색 결과를 찾을 수 없습니다.';

	var msgInfoExcept='외';
	var msgInfoDomains='개 도메인';

	$(document).ready(function() {
		var chkSession_custID = '2';

		if (chkSession_custID == '') {
			$('#logout').click();
		}

		$('#logout').on('click', function() {
			$('#formLogout').attr('action','/logout');
			$('#formLogout').submit();
		});

		var  languages = [
			"<option value='ko'>한국어</option>",
			"<option value='en'>English</option>"
		];
		$('#lang-select').html(languages);
		$('#lang-select').val("ko");

		$('#lang-select').on('change', function(){
			$.get("/management/account/sitelang/" + $(this).val() ,function() {}); // 이 라인 삭제하면 언어 변경 시 관련 버그 생김. ex) 메뉴권한정보 페이지

			$('#formLangSelect').attr('action', window.location.toString());
			$('#formLangSelect').submit();
		});

		// Minimalize menu
		$('.navbar-minimalize').on('click', function (event) {
			event.preventDefault();
			$("body").toggleClass("mini-navbar");

			callPortalGet('/api/session/menu/update', getCsrf());

			SmoothlyMenu();
		});

		// Close menu in canvas mode
		$('.close-canvas-menu').on('click', function (e) {
			e.preventDefault();
			$("body").toggleClass("mini-navbar");
			SmoothlyMenu();
		});

		function SmoothlyMenu() {
			if (!$('body').hasClass('mini-navbar') || $('body').hasClass('body-small')) {
				// Hide menu in order to smoothly turn on when maximize menu
				$('#side-menu').hide();
				// For smoothly turn on menu
				setTimeout(
						function () {
							$('#side-menu').fadeIn(400);
						}, 200);
			} else if ($('body').hasClass('fixed-sidebar')) {
				$('#side-menu').hide();
				setTimeout(
						function () {
							$('#side-menu').fadeIn(400);
						}, 100);
			} else {
				// Remove all inline style from jquery fadeIn function to reset menu state
				$('#side-menu').removeAttr('style');
			}
		}
	});
</script>


        <!-- page-heading //-->
        <div class="row wrapper border-bottom white-bg page-heading" id="heading" data-tab="management/domain">
            <div class="col-lg-10">
                <h2>ACL 이력</h2>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/dashboard"><i class="fa fa-home"></i> Home</a></li>
                    <li class="breadcrumb-item"><a href="/management/purge">관리</a></li>
                    <li class="breadcrumb-item"><a href="/management/acl/list">ACL 관리</a></li>
                    <li class="breadcrumb-item active"><strong>ACL 이력</strong></li>
                </ol>
            </div>
        </div>
        <!--// page-heading -->

        <!-- wrapper-content //-->
        <div class="wrapper wrapper-content animated fadeInRight">
            <div class="row">
                <!-- 상단 탭 -->
                



<div class="col-lg-12">
    <ul class="sub-tabs">
        <li class=""><a href="/management/acl/list">ACL 목록</a></li>

        
            <li class=""><a href="/management/acl/info">ACL 수정</a></li>
        
        

        <li class="tab-active"><a href="/management/acl/history">ACL 이력</a></li>
    </ul>
</div><!--//col-lg-12-->

                <div class="col-lg-12 m-b">
                    <h5>* 해당 도메인에 대한 ACL 정보 생성, 수정, 삭제 이력 정보를 제공합니다.</h5>
                </div>

                <div class="col-lg-12">
                    <div class="ibox">
                        <div class="ibox-content">
                            <form id="formSearch" onsubmit="return false;">
                                <div class="row form-group">
                                    <div class="col-lg-1">
                                        <i class="fa fa-filter"></i>
                                        <label class="col-form-label">도메인</label>
                                    </div>
                                    <div class="col-lg-6">
                                        <select name="domainSeq" id="domainSelect" class="form-control">
                                        </select>
                                    </div>
                                    <div class="col-lg-1">
                                        <i class="fa fa-filter"></i>
                                        <label class="col-form-label">Sub Path</label>
                                    </div>
                                    <div class="col-lg-4">
                                        <select name="subPathSeq" id="subPathSelect" class="form-control">
                                        </select>
                                    </div>
                                </div>

                                <div class="row form-group">
                                    <div class="col-lg-1">
                                        <label class="col-form-label">
                                            <i class="fa fa-filter"></i>
                                            기간 선택
                                        </label>
                                    </div>
                                    <div class="col-lg-2">
                                        <select name="dateSelect" id="dateSelect" class="form-control">
                                            <option value="today">오늘</option>
                                            <option value="yesterday">어제</option>
                                            <option value="last_7days">최근 7일</option>
                                            <option value="last_month">최근 1달</option>
                                            <option value="custom">직접 기간 선택</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-4">
                                        <div class="input-daterange input-group" id="datepicker">

                                            <input type="text" class="form-control-sm form-control" name="startDateStrWithFormat" readonly/>
                                            <span class="input-group-addon">~</span>
                                            <input type="text" class="form-control-sm form-control" name="endDateStrWithFormat" readonly/>
                                        </div>
                                    </div>
                                    <div class="col-lg-1">
                                        <label class="col-form-label">
                                            <i class="fa fa-filter"></i>
                                            ACL Type
                                        </label>
                                    </div>
                                    <div class="col-lg-4">
                                        <select name="aclType" id="aclType" class="form-control">
                                            <option value="0" selected>전체</option>
                                            <option value="general_acl">IP 제한</option>
                                            <option value="country_acl">국가 제한</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row form-group">
                                    <div class="col-lg-1">
                                        <label class="col-form-label">
                                            <i class="fa fa-filter"></i>
                                            보기 설정
                                        </label>
                                    </div>
                                    <div class="col-lg-4">
                                        <select name="domainsPerPage" id="domainsPerPage" class="form-control">
                                            <option value="10" selected>10개</option>
                                            <option value="50">50개</option>
                                            <option value="100">100개</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-7">
                                        <div class="input-group">
                                            <input type="text" class="form-control" name="searchKey" placeholder='검색어를 입력해주세요' value="">
                                            <span class="input-group-append">
                                                <button type="button" id="btnSearch" class="btn btn-black">
                                                    <i class="fa fa-search"></i>
                                                    조회
                                                </button>
                                            </span>
                                        </div><!--//input-group-->
                                    </div>
                                </div>
                            </form><!--//formSearch-->
                        </div><!--//ibox-content-->
                    </div><!--//ibox-->
                </div><!--//col-lg-12-->
                <div class="col-lg-12">
                    <div class="ibox">
                        <div class="ibox-content">
                            <div class="col-lg-12">
                                <div class="table-responsive">

                                </div><!--//table-responsive-->
                            </div>
                        </div><!--//ibox-content-->
                    </div><!--//ibox-->
                </div><!--//col-lg-12-->
            </div><!--// wrapper-content -->
        </div>
        <!-- footer -->
        

<div class="footer">
	<div class="float-right btn-xs">※ 본 사이트는 해상도 가로 1280px 이상을 권장하며, 사파리(Mac OS) / Chrome / IE11 이상의 최신 브라우저에 최적화되어 있습니다.</div>
</div>





<div class="wrap-loading display-none" style="z-index: 2051;"> <!-- modal z-index : 2050 -->
	<div>
		<i class="fa fa-spinner fa-pulse fa-4x fa-fw"></i>
	</div>
</div>
<!-- custom util scripts -->
<script language="JavaScript" src="/js/common_util.js" charset="UTF-8"></script>
    </div><!--// page-wrapper -->
</div><!--// wrapper -->

<!-- History detail modal template -->



<!-- Country Add Modal -->
<div class="modal inmodal fade" id="aclHistoryDetailModal" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
    <div class="modal-dialog modal-lg">
        <div class="modal-content animated fadeIn">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">ACL 이력 상세 보기</h4>
            </div>
            <div class="modal-body">
                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">도메인</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historyDomain"></span>
                    </div>
                </div>
                <hr/>
                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">Sub Path</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historySubPath"></span>
                    </div>
                </div>
                <hr/>

                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">실행 날짜</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historyRunDate"></span>
                    </div>
                </div>
                <hr/>

                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">수행 타입</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historyActionType"></span>
                    </div>
                </div>
                <hr/>

                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">상태</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historyStatus"></span>
                    </div>
                </div>
                <hr/>

                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">ACL Type</label>
                    <div class="col-lg-8">
                        <span class="form-text m-b-none" id="historyAclType"></span>
                    </div>
                </div>
                <hr/>

                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">추가 항목</label>
                    <div class="col-lg-8">
                        <div class="row" id="addListBasicPolicy">
                        </div>
                        <div class="row">
                            <div class="table-country-code col-lg-12">
                                <table class="table table-striped table-bordered table-hover dataTables-example dataTables-md" id="historyAddList">
                                    <thead>
                                    <tr>
                                        <th>순서</th>
                                        <th>정책 / ACL Type</th>
                                        <th>상태</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <hr/>


                <div class="form-group row">
                    <label class="col-lg-4 col-form-label font-bold">제거 항목</label>
                    <div class="col-lg-8">
                        <div class="row" id="deleteListBasicPolicy">
                        </div>
                        <div class="row">
                            <div class="table-country-code col-lg-12">
                                <table class="table table-striped table-bordered table-hover dataTables-example dataTables-md" id="historyDeleteList">
                                    <thead>
                                    <tr>
                                        <th>순서</th>
                                        <th>정책 / ACL Type</th>
                                        <th>상태</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <hr/>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-black" data-dismiss="modal">확인</button>
            </div>
        </div>
    </div>
</div>
<!-- END OF Portlet adder Modal -->

<link href="/css/plugins/dataTables/datatables.min.css" rel="stylesheet">

<!-- Data Table -->
<script src="/js/plugins/dataTables/datatables.min.js"></script>
<script src="/js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>

<script>
    var tableBasicOption = {
        pageLength: 5,
        lengthMenu: [[5, 10, 50, 100, -1], [5, 10, 50, 100, "All"]],
        ordering: false,
        responsive: true,
        dom: 'lfgtp',
        buttons: [
            { extend: 'csv', title: 'csv_file' },
            { extend: 'excel', title: 'excel_file' }
        ]
    };
    var configActionTypeLang = {
        'new_registration': '신규 등록',
        'change_acl_type': 'ACL Type 변경',
        'record_update': 'ACL 설정 변경',
        'delete_action': 'ACL 설정 삭제'
    };

    var aclTypeLang = {
        'country_acl': '국가 제한',
        'general_acl': 'IP 제한'
    };

    var policyTypeLang = {
        'country_codes': '국가 코드',
        'geo': 'GEO IP',
        'general_acl' : 'IP'
    };

    $(document).ready(function() {
        var addListTable = $('#historyAddList').DataTable(tableBasicOption);
        var deleteListTable = $('#historyDeleteList').DataTable(tableBasicOption);

        $(document).on("click", "[name='btnHistoryDetail']", function () {
            var tranId = $(this).data("tran-id");
            var subPathSeq = $(this).data("sub-path-seq");
            var domainSeq = $(this).data("domain-seq");

            var reqData = {
                tranId: tranId,
                subPathSeq: subPathSeq,
                domainSeq: domainSeq
            };

            callPortal('/api/management/acl/history-detail', reqData, getCsrf(), function(res) {
                if(res.success){
                    var json = JSON.parse(res.data);
                    var data = json.api_response.data;
                    var domainName = data.domain_name;
                    var subPath = data.path;
                    var status = data.status;
                    var actionType = data.config_action_type;
                    var regTime = data.reg_time;
                    var newAclType = aclTypeLang[data.new_acl_type];
                    var pastAclType = aclTypeLang[data.past_acl_type];
                    var deleteList = data.delete_list;
                    var addList = data.add_list;
                    var labelStatus = data.label_status;

                    var aclType = null;
                    if(pastAclType && newAclType){
                        aclType = pastAclType + ' → ' + newAclType;
                    } else if(pastAclType && !newAclType){
                        aclType = pastAclType;
                    } else if(!pastAclType && newAclType){
                        aclType = newAclType;
                    }

                    $('#historyDomain').text(domainName);
                    $('#historySubPath').text(subPath);
                    $('#historyRunDate').text(regTime);
                    // controller에서 보내주기
                    $('#historyActionType').text(configActionTypeLang[actionType]);
                    $('#historyStatus').text("");
                    $('#historyStatus').append(labelStatus);
                    $('#historyAclType').text(aclType);

                    deleteListTable.clear();
                    $("#deleteListBasicPolicy").html("");
                    deleteList.forEach(function(data, idx){
                        var tmpRecord = data.record;
                        if(tmpRecord === 'default'){
                            $("#deleteListBasicPolicy").append(getBasicPolicyDiv(data));
                            return true;
                        }
                        if(data.country_full_name){
                            tmpRecord += ' ('+ data.country_full_name + ') <i class="'+tmpRecord.toLowerCase()+' flag"></i>';
                        }
                        deleteListTable.row.add([
                            idx+1,
                            tmpRecord +' / ' + policyTypeLang[data.type],
                            data.method==="allow" ? "허용" : "제한"
                        ]);
                    });
                    deleteListTable.draw();

                    addListTable.clear();
                    $("#addListBasicPolicy").html("");
                    addList.forEach(function(data, idx){
                        var tmpRecord = data.record;
                        if(tmpRecord === 'default'){
                            $("#addListBasicPolicy").append(getBasicPolicyDiv(data));
                            return true;
                        }
                        if(data.country_full_name){
                            tmpRecord += ' ('+ data.country_full_name + ') <i class="'+tmpRecord.toLowerCase()+' flag"></i>';
                        }
                        addListTable.row.add([
                            idx+1,
                            tmpRecord +' / ' + policyTypeLang[data.type],
                            data.method==="allow" ? "허용" : "제한"
                        ]);
                    });
                    addListTable.draw();

                    $("#aclHistoryDetailModal").modal('show');
                }
            });
        });
    });

    function getBasicPolicyDiv(data){
        var policyTmp =  data.method==='allow' ? '허용' : '제한';
        return "<div class='font-bold col-lg-12' style='margin-left:15px;'>" + policyTypeLang[data.type] + " 기본 정책 : "+ policyTmp +"</div>";
    }
</script>

<!-- common js -->


<!-- Mainly scripts -->
<script type="text/javascript" src="/js/popper.min.js"></script>
<script type="text/javascript" src="/js/bootstrap.js"></script>
<script type="text/javascript" src="/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script type="text/javascript" src="/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- sub js -->


<!-- Custom and plugin javascript -->
<script src="/js/inspinia.js"></script>
<script src="/js/plugins/pace/pace.min.js"></script>

<!-- Toastr -->
<script src="/js/plugins/toastr/toastr.min.js"></script>

<script>
	$(document).ready(function() {
		
		
		
		
		
		
		
		

		
	});
</script>

<!-- Serialize object or json -->
<script src="/js/jquery.serializeObject.min.js" type="text/javascript"></script>

<!-- Select box -->
<script src="/js/plugins/chosen/chosen.jquery.js"></script>

<!-- Data picker -->
<script src="/js/plugins/datapicker/bootstrap-datepicker.js"></script>

<!-- Data Table -->
<script src="/js/plugins/dataTables/datatables.min.js"></script>
<script src="/js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>

<!-- Page-Level Scripts -->
<script>
    var aclHistoryTableOption = {
        pageLength: 10,
        responsive: true,
        processing: true,
        dom: 'gtp',
        columnDefs: [
            {
                targets: [ 7 ],
                visible: false,
                searchable: false
            },
            {
                targets: [ 8 ],
                visible: false,
                searchable: false
            }
        ]
    };

    var addDeleteTableOption = {
        pageLength: 5,
        lengthMenu: [[5, 10, -1], [5, 10, "All"]]
    };

    var aclHistoryTable;
    var aclAddListTable = {};
    var aclDeleteListTable = {};

    $(document).ready(function() {
        $('#domainSelect').append("<option value='58'>http://contents-test-01.dl.cdn.ons.nimbuscdn.net</option>");
        if("" && ""!=='0'){
            $('#domainSelect').val("");
        }
        if(""){
            $('#aclType').val("");
        }

        $('#domainSelect').chosen({ width: '100%', search_contains:"true" });
        $('#subPathSelect').chosen({ width: '100%', search_contains:"true" });
        $('#aclType').chosen({ width: '100%', disable_search: "true" });
        $('#domainsPerPage').chosen({ width: '100%', disable_search: "true" });
        $('#dateSelect').chosen({ width: '100%', disable_search: "true" });
        aclHistoryTable = $('#historyTable').DataTable(aclHistoryTableOption);
        initDatePicker();
        initSubPathList('domainSelect', 'subPathSelect', true);


        $('#btnSearch').on('click', function() {
            var reqData = {
                domainSeq: $('#domainSelect option:selected').val(),
                subPathSeq: $('#subPathSelect option:selected').val(),
                aclType : $('#aclType option:selected').val(),
                searchKey : $("[name='searchKey']").val(),
                historyStartDate : $("input[name='startDateStrWithFormat']").val(),
                historyEndDate : $("input[name='endDateStrWithFormat']").val()
            };
            // session
            callPortal('/api/session/config/acl', reqData, getCsrf());

            initTable();
        });

        $('input').on('keydown', function(event) {
            if(event.keyCode == 13) {
                initTable();
            }
        });

        $('#domainSelect').on('change', function() {
            initSubPathList('domainSelect', 'subPathSelect', false);
        });

        $('#dateSelect').on('change', function(){
            var startDate = new Date();
            var endDate = new Date();

            var updateDate = true;
            switch($('#dateSelect').val()){
                case "today":
                    break;

                case "yesterday":
                    startDate.setDate(startDate.getDate()-1);
                    break;

                case "last_7days":
                    startDate.setDate(startDate.getDate()-7);
                    break;

                case "last_month":
                    startDate.setMonth(startDate.getMonth() - 1);
                    break;

                case "custom":
                    updateDate = false;
                    break;

                default:
                    updateDate = false;
                    break;
            }

            if(updateDate){
                $("input[name='startDateStrWithFormat']").datepicker('update', startDate);
                $("input[name='endDateStrWithFormat']").datepicker('update', endDate);
            }
        });

        $("[name=startDateStrWithFormat], [name=endDateStrWithFormat]").datepicker().on("changeDate", function(){
            $('#dateSelect').val("custom");
            $("#dateSelect").trigger("chosen:updated");
        });

        $(document).on("click", "#btnDropDown", function(){
            var icon = $(this).children('i');
            var tr = $(this).closest('tr');
            var row = aclHistoryTable.row( tr );

            var dropDownClass = "fa-chevron-circle-up icon-gray";
            var dropUpClass = "fa-chevron-circle-down";

            if ( row.child.isShown() ) {
                icon.removeClass(dropDownClass).addClass(dropUpClass);
                row.child.hide();
                tr.removeClass('shown');
            }
            else {
                icon.removeClass(dropUpClass).addClass(dropDownClass);
                row.child( format(row.data()) ).show();
                tr.addClass('shown');

                var index = $(this).parents('tr').data("row-number");
                var addName = "add_list"+index;
                var deleteName = "delete_list"+index;
                aclAddListTable[index] = $("#"+addName).DataTable(addDeleteTableOption);
                aclDeleteListTable[index] = $("#"+deleteName).DataTable(addDeleteTableOption);
            }
        });

    });

    function initTable() {
        $('div.table-responsive').html("");
        $('div.table-responsive').append('<table class="table table-striped table-bordered" id="historyTable" style="width:100%"><thead></thead><tbody></tbody></table>');

        callPortal('/api/management/acl/history', $('#formSearch').serializeObject(), getCsrf(), function(res) {
            if(res.success) {
                aclHistoryTable.destroy();
                var json = JSON.parse(res.data);
                $('#historyTable thead').append(json.tableHead);
                $('#historyTable tbody').append(json.tableBody);
                aclHistoryTableOption.pageLength = Number($('#domainsPerPage').val());
                aclHistoryTable = $('#historyTable').DataTable(aclHistoryTableOption);
            }
        });
    }

    function initDatePicker() {

        // 현재로 부터 최대 6개월 전까지 검색 가능
        var minDate = new Date();
        minDate.setMonth(minDate.getMonth() - 6);
        var dateOption = {
            todayBtn: "linked",
            autoclose: true,
            toggleActive: false,
            todayHighlight: true,
            forceParse: true,
            format: "yyyy-mm-dd",
            immediateUpdates: true,
            startDate: minDate
        };

        var startDate;
        var endDate;

        if("" && ""){
            $('#dateSelect').val("custom");

            startDate = new Date("");
            endDate = new Date("");
        } else {
            $('#dateSelect').val("last_month");

            startDate = new Date();
            endDate = new Date();
            startDate.setMonth(startDate.getMonth() - 1);
        }

        $("#dateSelect").trigger("chosen:updated");
        $("input[name='startDateStrWithFormat']").datepicker(dateOption).datepicker("setDate", startDate);
        $("input[name='endDateStrWithFormat']").datepicker(dateOption).datepicker("setDate", endDate);
    }

    function initSubPathList(domainSelect, subPathSelect, useSession){
        var reqData = {
            domainSeq: $('#'+domainSelect+' option:selected').val()
        };

        callPortal('/api/management/acl/sub-path', reqData, getCsrf(), function(res) {
            if(res.success){
                $('#'+subPathSelect+'').html("");
                $('#'+subPathSelect+'').chosen('destroy');
                $('#'+subPathSelect+'').append('<option value="0" selected>전체</option>');
                $('#'+subPathSelect+'').append(res.data);

                if("" && useSession){
                    $('#'+subPathSelect+'').val("");
                }
                $('#'+subPathSelect+'').chosen({ width: '100%', search_contains:"true" });

                if(useSession){
                    initTable();
                }
            }
        });
    }

    function format( rowData ) {
        var jsonAddTable = rowData[7];
        var jsonDeleteTable = rowData[8];

        var result = '<div class="row">';
        result += '<div class="col-md-6" style="padding-left: 20px; padding-right: 20px;">'+
            '<h4>추가 목록</option></h4>'+
            jsonAddTable+
            '</div>';
        result += '<div class="col-md-6" style="padding-left: 20px; padding-right: 20px;">'+
            '<h4>제거 목록</option></h4>'+
            jsonDeleteTable+
            '</div>';

        return result;
    }
</script>
</body>
</html>